<div class="security-container">
    <h1>üîê Security</h1>

    <!-- API KEY SECTION -->
    <section class="security-section">
        <h2>API Key</h2>
        <p class="section-description">
            The API Key allows you to authenticate programmatic API calls.
            Generate a key and use it in the <code>X-Api-Key</code> header.
        </p>

        <div class="api-key-status" *ngIf="!isLoadingApiKey">
            <div *ngIf="!apiKeyInfo?.exists" class="no-key-message">
                <span class="status-icon">‚ö†Ô∏è</span>
                <span>No API Key configured.</span>
            </div>

            <div *ngIf="apiKeyInfo?.exists && !generatedKey" class="key-info">
                <div class="key-detail">
                    <span class="label">Prefix:</span>
                    <code>{{ apiKeyInfo?.prefix }}</code>
                </div>
                <div class="key-detail">
                    <span class="label">Created on:</span>
                    <span>{{ apiKeyInfo?.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                </div>
            </div>

            <!-- Generated Key Display -->
            <div *ngIf="generatedKey" class="generated-key-box">
                <div class="warning-banner">
                    ‚ö†Ô∏è <strong>Save this key now!</strong> It will not be visible again.
                </div>
                <div class="key-display">
                    <code>{{ generatedKey }}</code>
                    <button class="btn-copy" (click)="copyKey()">
                        {{ keyCopied ? '‚úì Copied!' : 'üìã Copy' }}
                    </button>
                </div>
                <button class="btn-secondary" (click)="dismissGeneratedKey()">
                    I have saved the key
                </button>
            </div>

            <!-- Confirm Regenerate -->
            <div *ngIf="showConfirmRegenerate" class="confirm-box">
                <p>‚ö†Ô∏è Regenerating the key will invalidate the existing one. Continue?</p>
                <div class="confirm-actions">
                    <button class="btn-danger" (click)="generateApiKey()" [disabled]="isGeneratingApiKey">
                        Yes, regenerate
                    </button>
                    <button class="btn-secondary" (click)="cancelRegenerate()">Cancel</button>
                </div>
            </div>

            <!-- Generate Button -->
            <div *ngIf="!generatedKey && !showConfirmRegenerate" class="actions">
                <button class="btn-primary" (click)="generateApiKey()" [disabled]="isGeneratingApiKey">
                    {{ apiKeyInfo?.exists ? 'üîÑ Regenerate API Key' : 'üîë Generate API Key' }}
                </button>
            </div>
        </div>

        <div *ngIf="isLoadingApiKey" class="loading">Loading...</div>
    </section>

    <!-- PASSWORD SECTION -->
    <section class="security-section">
        <h2>Change Password</h2>
        <p class="section-description">
            Update your account password.
        </p>

        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="password-form">
            <div class="form-group">
                <label for="currentPassword">Current password</label>
                <input type="password" id="currentPassword" formControlName="currentPassword"
                    placeholder="Enter current password">
            </div>

            <div class="form-group">
                <label for="newPassword">New password</label>
                <input type="password" id="newPassword" formControlName="newPassword" placeholder="Enter new password">
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirm new password</label>
                <input type="password" id="confirmPassword" formControlName="confirmPassword"
                    placeholder="Repeat new password">
            </div>

            <div *ngIf="passwordMessage" class="success-message">‚úì {{ passwordMessage }}</div>
            <div *ngIf="passwordError" class="error-message">‚úó {{ passwordError }}</div>

            <button type="submit" class="btn-primary" [disabled]="passwordForm.invalid || isChangingPassword">
                {{ isChangingPassword ? 'Saving...' : 'Change Password' }}
            </button>
        </form>
    </section>
</div>