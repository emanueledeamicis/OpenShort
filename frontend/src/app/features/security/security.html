<div class="px-6 py-8">
    <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-bold text-surface-900 dark:text-surface-0">üîê Security</h1>
    </div>

    <!-- API KEY SECTION -->
    <div
        class="card bg-surface-0 dark:bg-surface-900 border border-surface-200 dark:border-surface-700 rounded-xl p-6 mb-6">
        <h2 class="text-xl font-semibold text-surface-900 dark:text-surface-0 mb-2">API Key</h2>
        <p class="text-surface-600 dark:text-surface-400 mb-4">
            The API Key allows you to authenticate programmatic API calls.
            Generate a key and use it in the <code
                class="bg-surface-100 dark:bg-surface-800 px-1 rounded">X-Api-Key</code> header.
        </p>

        <!-- Loading -->
        <div *ngIf="isLoadingApiKey" class="text-surface-500">
            <i class="pi pi-spin pi-spinner mr-2"></i> Loading...
        </div>

        <div *ngIf="!isLoadingApiKey">
            <!-- No API Key -->
            <p-message *ngIf="!apiKeyInfo?.exists && !generatedKey" severity="warn" text="No API Key configured."
                styleClass="mb-4" />

            <!-- Existing Key Info -->
            <div *ngIf="apiKeyInfo?.exists && !generatedKey" class="mb-4">
                <div class="flex gap-6 text-surface-700 dark:text-surface-300">
                    <div>
                        <span class="font-medium">Prefix:</span>
                        <code
                            class="ml-2 bg-surface-100 dark:bg-surface-800 px-2 py-1 rounded">{{ apiKeyInfo?.prefix }}</code>
                    </div>
                    <div>
                        <span class="font-medium">Created:</span>
                        <span class="ml-2">{{ apiKeyInfo?.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
                    </div>
                </div>
            </div>

            <!-- Generated Key Display -->
            <div *ngIf="generatedKey" class="mb-4">
                <p-message severity="warn" styleClass="mb-3">
                    <span class="font-bold">Save this key now!</span> It will not be visible again.
                </p-message>
                <div
                    class="flex items-center gap-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3">
                    <code
                        class="flex-1 text-green-700 dark:text-green-300 font-mono break-all">{{ generatedKey }}</code>
                    <p-button [label]="keyCopied ? 'Copied!' : 'Copy'" [icon]="keyCopied ? 'pi pi-check' : 'pi pi-copy'"
                        severity="success" [outlined]="true" (onClick)="copyKey()" />
                </div>
                <p-button label="I have saved the key" severity="secondary" [text]="true"
                    (onClick)="dismissGeneratedKey()" styleClass="mt-3" />
            </div>

            <!-- Confirm Regenerate -->
            <div *ngIf="showConfirmRegenerate"
                class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-4">
                <p class="text-yellow-800 dark:text-yellow-200 mb-3">‚ö†Ô∏è Regenerating the key will invalidate the
                    existing one. Continue?</p>
                <div class="flex gap-2">
                    <p-button label="Yes, regenerate" severity="danger" (onClick)="generateApiKey()"
                        [loading]="isGeneratingApiKey" />
                    <p-button label="Cancel" severity="secondary" [text]="true" (onClick)="cancelRegenerate()" />
                </div>
            </div>

            <!-- Generate Button -->
            <div *ngIf="!generatedKey && !showConfirmRegenerate">
                <p-button [label]="apiKeyInfo?.exists ? 'Regenerate API Key' : 'Generate API Key'"
                    [icon]="apiKeyInfo?.exists ? 'pi pi-refresh' : 'pi pi-key'" (onClick)="promptGenerateApiKey()"
                    [loading]="isGeneratingApiKey" />
            </div>
        </div>
    </div>

    <!-- PASSWORD SECTION -->
    <div class="card bg-surface-0 dark:bg-surface-900 border border-surface-200 dark:border-surface-700 rounded-xl p-6">
        <h2 class="text-xl font-semibold text-surface-900 dark:text-surface-0 mb-2">Change Password</h2>
        <p class="text-surface-600 dark:text-surface-400 mb-4">
            Update your account password.
        </p>

        <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="flex flex-col gap-4 max-w-md">
            <div class="flex flex-col gap-2">
                <label for="currentPassword" class="font-medium text-surface-700 dark:text-surface-300">Current
                    password</label>
                <input pInputText id="currentPassword" type="password" formControlName="currentPassword"
                    placeholder="Enter current password" class="w-full" />
            </div>

            <div class="flex flex-col gap-2">
                <label for="newPassword" class="font-medium text-surface-700 dark:text-surface-300">New password</label>
                <input pInputText id="newPassword" type="password" formControlName="newPassword"
                    placeholder="Enter new password" class="w-full" />
            </div>

            <div class="flex flex-col gap-2">
                <label for="confirmPassword" class="font-medium text-surface-700 dark:text-surface-300">Confirm new
                    password</label>
                <input pInputText id="confirmPassword" type="password" formControlName="confirmPassword"
                    placeholder="Repeat new password" class="w-full" />
            </div>

            <p-message *ngIf="passwordMessage" severity="success" [text]="passwordMessage" />
            <p-message *ngIf="passwordError" severity="error" [text]="passwordError" />

            <p-button type="submit" label="Change Password" icon="pi pi-lock" [disabled]="passwordForm.invalid"
                [loading]="isChangingPassword" />
        </form>
    </div>
</div>